hospital_sf <- st_as_sf(hospital_data, coords=c("Long", "Lat"), crs=4326) %>% st_transform(crs = 3414)
head(hospital_sf, 5)
poly_sf <- st_as_sf(poly_data, coords=c("Long", "Lat"), crs=4326) %>% st_transform(crs = 3414)
head(poly_sf, 5)
nursing_sf <- st_as_sf(nursing_data, coords=c("Long", "Lat"), crs=4326) %>% st_transform(crs = 3414)
head(nursing_sf, 5)
pcn_sf <- st_as_sf(pcn_data, coords=c("results.LONGITUDE", "results.LATITUDE"), crs=4326) %>% st_transform(crs = 3414)
#head(nursing_sf, 5)
pop_is_char <- sapply(pop_data[c(2:19)], is.character)
pop_data[c(2:19)][ , pop_is_char] <- as.data.frame(apply(pop_data[c(2:19)][ , pop_is_char], 2, as.numeric))
pop_data$...1  = toupper(pop_data$...1)
mpsz <- st_make_valid(mpsz)
total_pop <- merge(x = mpsz, y = pop_data, by.x = "SUBZONE_N", by.y = "...1", all.x = TRUE)
saveRDS(total_pop, file = "data/models/total_pop.rds")
runApp()
runApp()
hexagon_Hansen <- st_join(hexagon_PCN_Clinics_Hansen, mpsz,
join = st_intersects)
hexagon_Hansen <- st_join(hexagon_PCN_Clinics_Hansen, mpsz,
join = st_intersects)
pacman::p_load(tmap, SpatialAcc, sf,
ggstatsplot, reshape2,
tidyverse)
mpsz <- st_read(dsn = "data/geospatial", layer = "MP14_SUBZONE_NO_SEA_PL")
hexagons <- st_read(dsn = "data/geospatial", layer = "hexagons")
hexagons_2019 <- st_read(dsn = "data/geospatial/Hexagon 2019 Shapefile",
layer = "Hexagon_2019")
eldercare <- st_read(dsn = "data/geospatial", layer = "ELDERCARE")
PCN_Clinics <- st_read(dsn = "data/geospatial/PCN Network Clinics Shapefile",
layer = "PCN Network Clinics")
mpsz <- st_transform(mpsz, 3414)
eldercare <- st_transform(eldercare, 3414)
PCN_Clinics <- st_transform(PCN_Clinics, 3414)
hexagons <- st_transform(hexagons, 3414)
hexagons_2019 <- st_transform(hexagons_2019, 3414)
st_crs(mpsz)
st_crs(hexagons)
eldercare <- eldercare %>%
select(fid, ADDRESSPOS) %>%
mutate(capacity = 100)
pacman::p_load(tmap, SpatialAcc, sf,
ggstatsplot, reshape2,
tidyverse)
mpsz <- st_read(dsn = "data/geospatial", layer = "MP14_SUBZONE_NO_SEA_PL")
hexagons <- st_read(dsn = "data/geospatial", layer = "hexagons")
hexagons_2019 <- st_read(dsn = "data/geospatial/Hexagon 2019 Shapefile",
layer = "Hexagon_2019")
eldercare <- st_read(dsn = "data/geospatial", layer = "ELDERCARE")
PCN_Clinics <- st_read(dsn = "data/geospatial/PCN Network Clinics Shapefile",
layer = "PCN Network Clinics")
mpsz <- st_transform(mpsz, 3414)
eldercare <- st_transform(eldercare, 3414)
PCN_Clinics <- st_transform(PCN_Clinics, 3414)
hexagons <- st_transform(hexagons, 3414)
hexagons_2019 <- st_transform(hexagons_2019, 3414)
st_crs(mpsz)
st_crs(hexagons)
eldercare <- eldercare %>%
select(fid, ADDRESSPOS) %>%
mutate(capacity = 100)
View(total_pop)
View(total_pop)
View(total_pop)
gp_bw <- density(gp_ppp.km,
sigma = bw.diggle,
edge = TRUE,
kernel = "gaussian")
gp_bw <- raster::density(gp_ppp.km,
sigma = bw.diggle,
edge = TRUE,
kernel = "gaussian")
gp_bw <- raster::density(gp_ppp.km,
sigma = bw.diggle,
edge = TRUE,
kernel = "gaussian")
pacman::p_load(readr, sf, tmap, spatstat, sfdep, tidyverse, maptools, raster, SpatialAcc, ggstatsplot, reshape2, rgdal, spNetwork)
gp_data <- read_csv("data/aspatial/gp_data_geocoded.csv")[,-1]
head(gp_data, 5)
hospital_data <- read_csv("data/aspatial/hospital_data_geocoded.csv")
head(hospital_data, 5)
poly_data <- read_csv("data/aspatial/polyclinic_data_geocoded.csv")
head(poly_data, 5)
nursing_data <- read_csv("data/aspatial/nursing_home_data_geocoded.csv")
head(nursing_data, 5)
pcn_data <- read_csv("data/aspatial/PCN Clinic Listing (by PCN) With Postal Code.csv")
head(pcn_data, 5)
pop_data <- read_csv("data/aspatial/Resident Population 2015.csv", skip=11)[1:379,1:19]
head(pop_data, 5)
pcn_data <- readr::read_csv("data/aspatial/PCN Clinic Listing (by PCN) With Postal Code.csv")
mpsz <- st_read(dsn = "data/geospatial/MPSZ-2019",
layer = "MPSZ-2019") %>%
st_transform(crs = 3414)
head(mpsz, 5)
busstop_sf <- st_read(dsn = "data/geospatial/BusStop_Feb2023",
layer = "BusStop") %>%
st_transform(crs = 3414)
head(busstop_sf, 5)
trainstation_sf <- st_read(dsn = "data/geospatial/TrainStation_Feb2023",
layer = "RapidTransitSystemStation")[,c(-1, -2)] %>%
st_transform(crs = 3414)
head(trainstation_sf, 5)
chas_sf <- st_read(dsn = "data/geospatial/CHAS Clinics Shapefile",
layer = "CHAS Clinics") %>%
st_transform(crs = 3414)
head(chas_sf, 5)
chas_sf <- chas_sf[rowSums(is.na(chas_sf)) == 0, ]
#pcn_sf <- st_as_sf(pcn_data, coords=c("results.LONGITUDE", "results.LATITUDE"), crs=4326) %>% st_transform(crs = 3414)
#pcn_data$results.LATITUDE
#pcn_data[is.na(pcn_data$results.LATITUDE),]
chas_sf <- chas_sf[rowSums(is.na(chas_sf)) == 0, ]
pcn_data <- pcn_data[rowSums(is.na(pcn_data)) == 0, ]
gp_sf <- st_as_sf(gp_data, coords=c("Long", "Lat"), crs=4326) %>% st_transform(crs = 3414)
head(gp_sf, 5)
hospital_sf <- st_as_sf(hospital_data, coords=c("Long", "Lat"), crs=4326) %>% st_transform(crs = 3414)
head(hospital_sf, 5)
poly_sf <- st_as_sf(poly_data, coords=c("Long", "Lat"), crs=4326) %>% st_transform(crs = 3414)
head(poly_sf, 5)
nursing_sf <- st_as_sf(nursing_data, coords=c("Long", "Lat"), crs=4326) %>% st_transform(crs = 3414)
head(nursing_sf, 5)
pcn_sf <- st_as_sf(pcn_data, coords=c("results.LONGITUDE", "results.LATITUDE"), crs=4326) %>% st_transform(crs = 3414)
#head(nursing_sf, 5)
pop_is_char <- sapply(pop_data[c(2:19)], is.character)
pop_data[c(2:19)][ , pop_is_char] <- as.data.frame(apply(pop_data[c(2:19)][ , pop_is_char], 2, as.numeric))
pop_data$...1  = toupper(pop_data$...1)
mpsz <- st_make_valid(mpsz)
total_pop <- merge(x = mpsz, y = pop_data, by.x = "SUBZONE_N", by.y = "...1", all.x = TRUE)
saveRDS(total_pop, file = "data/models/total_pop.rds")
length(which(st_is_valid(trainstation_sf) == FALSE))
trainstation_sf <- trainstation_sf[st_is_valid(trainstation_sf) == TRUE,]
trainstation_sf <- trainstation_sf[!st_is_empty(trainstation_sf),,drop=FALSE]
length(which(st_is_valid(trainstation_sf) == FALSE))
length(which(st_is_valid(mpsz) == FALSE))
length(which(st_is_valid(mpsz) == FALSE))
gp_sf <- st_intersection(mpsz, gp_sf)
hospital_sf <- st_intersection(mpsz, hospital_sf)
poly_sf <- st_intersection(mpsz, poly_sf)
nursing_sf <- st_intersection(mpsz, nursing_sf)
busstop_sf <- st_intersection(mpsz, busstop_sf)
trainstation_sf <- st_intersection(mpsz, trainstation_sf)
chas_sf <- st_intersection(mpsz, chas_sf)
pcn_sf <- st_intersection(mpsz, pcn_sf)
tmap_mode("view")
tm_shape(total_pop) +
tm_polygons(
"Total...2",
style = "cont",
alpha = 0.4) +
tm_fill(palette = "Blues") +
tm_shape(gp_sf) +
tm_symbols(shape=24,
col  = "blue",
size = 0.15) +
tm_layout(main.title="General Practitioner Clinics",
main.title.position = "center") +
tm_view(set.zoom.limits = c(11,14),
set.view = 11,
set.bounds = TRUE)
general_hospital = hospital_sf[hospital_sf$TYPE == "GENERAL",]
specialised_hospital = hospital_sf[hospital_sf$TYPE == "SPECIALISED",]
community_hospital = hospital_sf[hospital_sf$TYPE == "COMMUNITY",]
tm_shape(total_pop) +
tm_polygons(
"Total...2",
style = "cont",
alpha = 0.4) +
tm_shape(general_hospital) +
tm_symbols(
shape=23,
col  = "red",
size = 0.15) +
tm_shape(specialised_hospital) +
tm_symbols(
shape=23,
col  = "blue",
size = 0.15) +
tm_shape(community_hospital) +
tm_symbols(
shape=23,
col  = "green",
size = 0.15) +
tm_layout(main.title="Hospitals",
main.title.position = "center")
tmap_mode("plot")
tm_shape(total_pop) +
tm_polygons(
"Total...2",
style = "cont",
alpha = 0.4) +
tm_shape(poly_sf) +
tm_symbols(shape=22,
col  = "orange",
size = 0.15) +
tm_layout(main.title="Polyclinics",
main.title.position = "center")
tmap_mode("plot")
tm_shape(total_pop) +
tm_polygons(
"Total...2",
style = "cont",
alpha = 0.4) +
tm_shape(nursing_sf) +
tm_symbols(shape=21,
col  = "green",
size = 0.15) +
tm_layout(main.title="Nursing Homes",
main.title.position = "center")
tmap_mode("plot")
tm_shape(total_pop) +
tm_polygons(
"Total...2",
style = "cont",
alpha = 0.4) +
tm_shape(busstop_sf) +
tm_symbols(shape=20,
col  = "darkblue",
size = 0.15) +
tm_layout(main.title="Bus Stops",
main.title.position = "center")
mrt <- trainstation_sf[trainstation_sf$TYP_CD_DES == "MRT",]
lrt <- trainstation_sf[trainstation_sf$TYP_CD_DES == "LRT",]
tmap_mode("plot")
tm_shape(total_pop) +
tm_polygons(
"Total...2",
style = "cont",
alpha = 0.4) +
tm_shape(mrt) +
tm_symbols(shape=20,
col  = "green",
size = 0.15) +
tm_shape(lrt) +
tm_symbols(shape=20,
col  = "darkgreen",
size = 0.15) +
tm_layout(main.title="Train Stations",
main.title.position = "center")
tmap_mode("plot")
tm_shape(total_pop) +
tm_polygons(
"Total...2",
style = "cont",
alpha = 0.4,) +
tm_fill(col="oranges") +
tm_shape(chas_sf) +
tm_symbols(shape=24,
col  = "blue",
size = 0.15) +
tm_layout(main.title="CHAS Clinics",
main.title.position = "center")
pacman::p_load(DiagrammeR)
grViz(diagram = "digraph flowchart {
graph [layout = dot, rankdir = LR]
node [fontname = arial, shape = oval]
tab1 [label = '@@1']
tab2 [label = '@@2']
tab3 [label = '@@3']
tab4 [label = '@@4']
tab1 -> tab2 -> tab3 -> tab4;
}
[1]: 'simple feature'
[2]: 'spatial*'
[3]: 'generic spatial'
[4]: 'ppp'
")
mpsz_spatial <- as_Spatial(mpsz)
gp_spatial <- as_Spatial(gp_sf)
hospital_spatial <- as_Spatial(hospital_sf)
poly_spatial <- as_Spatial(poly_sf)
nursing_spatial <- as_Spatial(nursing_sf)
busstop_spatial <- as_Spatial(busstop_sf)
trainstation_spatial <- as_Spatial(trainstation_sf)
chas_spatial <- as_Spatial(chas_sf)
pcn_spatial <- as_Spatial(pcn_sf)
mpsz_sp <- as(mpsz_spatial, "SpatialPolygons")
gp_sp <- as(gp_spatial, "SpatialPoints")
hospital_sp <- as(hospital_spatial, "SpatialPoints")
poly_sp <- as(poly_spatial, "SpatialPoints")
nursing_sp <- as(nursing_spatial, "SpatialPoints")
busstop_sp <- as(busstop_spatial, "SpatialPoints")
chas_sp <- as(chas_spatial, "SpatialPoints")
pcn_sp <- as(pcn_spatial, "SpatialPoints")
trainstation_sp <- as(trainstation_spatial, "SpatialPolygons")
gp_ppp <- as(gp_sp, "ppp")
hospital_ppp <- as(hospital_sp, "ppp")
poly_ppp <- as(poly_sp, "ppp")
nursing_ppp <- as(nursing_sp, "ppp")
busstop_ppp <- as(busstop_sp, "ppp")
chas_ppp <- as(chas_sp, "ppp")
pcn_ppp <- as(pcn_sp, "ppp")
plot(mpsz_spatial, main="General Practitioner Clinics")
plot(gp_ppp, main="General Practitioner Clinics")
plot(hospital_ppp, main="Hospitals")
plot(poly_ppp, main="Polyclinics")
plot(nursing_ppp, main="Nursing Homes")
plot(busstop_ppp, main="Bus Stops")
plot(trainstation_spatial, main="Mrt Stations")
plot(chas_ppp, main="CHAS Clinics")
any(duplicated(gp_ppp))
any(duplicated(hospital_ppp))
any(duplicated(poly_ppp))
any(duplicated(nursing_ppp))
any(duplicated(busstop_ppp))
any(duplicated(chas_ppp))
sum(multiplicity(gp_ppp) > 1)
sum(multiplicity(nursing_ppp) > 1)
sum(multiplicity(busstop_ppp) > 1)
sum(multiplicity(pcn_ppp) > 1)
gp_ppp_jit <- rjitter(gp_ppp,retry = TRUE,
nsim = 1,
drop = TRUE)
any(duplicated(gp_ppp_jit))
nursing_ppp_jit <- rjitter(nursing_ppp,retry = TRUE,
nsim = 1,
drop = TRUE)
any(duplicated(nursing_ppp_jit))
busstop_ppp_jit <- rjitter(busstop_ppp,retry = TRUE,
nsim = 1,
drop = TRUE)
any(duplicated(busstop_ppp_jit))
chas_ppp_jit <- rjitter(chas_ppp,retry = TRUE,
nsim = 1,
drop = TRUE)
any(duplicated(chas_ppp_jit))
pcn_ppp_jit <- rjitter(pcn_ppp,retry = TRUE,
nsim = 1,
drop = TRUE)
any(duplicated(pcn_ppp_jit))
mpsz_owin <- as(mpsz_sp, "owin")
gp_ppp = gp_ppp_jit[mpsz_owin]
hospital_ppp = hospital_ppp[mpsz_owin]
poly_ppp = poly_ppp[mpsz_owin]
nursing_ppp = nursing_ppp_jit[mpsz_owin]
busstop_ppp = busstop_ppp_jit[mpsz_owin]
chas_ppp = chas_ppp_jit[mpsz_owin]
pcn_ppp = pcn_ppp_jit[mpsz_owin]
mpsz_owin
gp_ppp.km <- rescale(gp_ppp, 1000, "km")
hospital_ppp.km <- rescale(hospital_ppp, 1000, "km")
poly_ppp.km <- rescale(poly_ppp, 1000, "km")
nursing_ppp.km <- rescale(nursing_ppp, 1000, "km")
busstop_ppp.km <- rescale(busstop_ppp, 1000, "km")
chas_ppp.km <- rescale(chas_ppp, 1000, "km")
pcn_ppp.km <- rescale(pcn_ppp, 1000, "km")
saveRDS(pcn_ppp.km, file = "data/models/pcn_ppp_km.rds")
gp_bw <- density(gp_ppp.km,
sigma = bw.diggle,
edge = TRUE,
kernel = "gaussian")
plot(gp_bw, main = "General Practitioner Clinics")
runApp()
hexagon_Hansen <- st_join(hexagon_eldercare_Hansen, mpsz,
join = st_intersects)
hexagon_Hansen <- st_join(hexagon_eldercare_Hansen, mpsz,
join = st_intersects)
hexagon_Hansen <- st_join(hexagon_PCN_Clinics_Hansen, mpsz,
join = st_intersects)
hexagon_PCN_Clinics_Hansen <- bind_cols(hexagons_2019, acc_PCN_Clinics_Hansen)
pacman::p_load(tmap, SpatialAcc, sf,
ggstatsplot, reshape2,
tidyverse)
mpsz <- st_read(dsn = "data/geospatial", layer = "MP14_SUBZONE_NO_SEA_PL")
hexagons <- st_read(dsn = "data/geospatial", layer = "hexagons")
hexagons_2019 <- st_read(dsn = "data/geospatial/Hexagon 2019 Shapefile",
layer = "Hexagon_2019")
eldercare <- st_read(dsn = "data/geospatial", layer = "ELDERCARE")
PCN_Clinics <- st_read(dsn = "data/geospatial/PCN Network Clinics Shapefile",
layer = "PCN Network Clinics")
mpsz <- st_transform(mpsz, 3414)
eldercare <- st_transform(eldercare, 3414)
PCN_Clinics <- st_transform(PCN_Clinics, 3414)
hexagons <- st_transform(hexagons, 3414)
hexagons_2019 <- st_transform(hexagons_2019, 3414)
st_crs(mpsz)
st_crs(hexagons)
eldercare <- eldercare %>%
select(fid, ADDRESSPOS) %>%
mutate(capacity = 100)
PCN_Clinics <- PCN_Clinics %>%
select(fid, results.PO) %>%
mutate(capacity = 100)
hexagons <- hexagons %>%
select(fid) %>%
mutate(demand = 100)
hexagons_2019 <- hexagons_2019 %>%
select(fid) %>%
mutate(demand = 100)
ODMatrix_eldercare <- read_csv("data/aspatial/Hands-On Ex10 OD Matrix/OD_Matrix.csv", skip = 0)
ODMatrix_PCN_Clinic <- read_csv("data/aspatial/Group OD Matrix/Output OD Matrix PCN Clinics 2.csv", skip = 0)
distmat_eldercare <- ODMatrix_eldercare %>%
select(origin_id, destination_id, total_cost) %>%
spread(destination_id, total_cost)%>%
select(c(-c('origin_id')))
distmat_PCN_Clinics <- ODMatrix_PCN_Clinic %>%
select(origin_id, destination_id, total_cost) %>%
spread(destination_id, total_cost)%>%
select(c(-c('origin_id')))
distmat_eldercare_km <- as.matrix(distmat_eldercare/1000)
distmat_PCN_Clinics_km <- as.matrix(distmat_PCN_Clinics/1000)
acc_eldercare_Hansen <- data.frame(ac(hexagons$demand,
eldercare$capacity,
distmat_eldercare_km,
#d0 = 50,
power = 2,
family = "Hansen"))
acc_PCN_Clinics_Hansen <- data.frame(ac(hexagons_2019$demand,
PCN_Clinics$capacity,
distmat_PCN_Clinics_km,
#d0 = 50,
power = 2,
family = "Hansen"))
colnames(acc_eldercare_Hansen) <- "accHansen"
colnames(acc_PCN_Clinics_Hansen) <- "accHansen"
acc_eldercare_Hansen <- tbl_df(acc_eldercare_Hansen)
acc_PCN_Clinics_Hansen <- tbl_df(acc_PCN_Clinics_Hansen)
hexagon_eldercare_Hansen <- bind_cols(hexagons, acc_eldercare_Hansen)
hexagon_PCN_Clinics_Hansen <- bind_cols(hexagons_2019, acc_PCN_Clinics_Hansen)
acc_eldercare_Hansen <- data.frame(ac(hexagons$demand,
eldercare$capacity,
distmat_eldercare_km,
#d0 = 50,
power = 0.5,
family = "Hansen"))
colnames(acc_eldercare_Hansen) <- "accHansen"
acc_eldercare_Hansen <- tbl_df(acc_eldercare_Hansen)
hexagon_eldercare_Hansen <- bind_cols(hexagons, acc_eldercare_Hansen)
acc_PCN_Clinics_Hansen <- data.frame(ac(hexagons_2019$demand,
PCN_Clinics$capacity,
distmat_PCN_Clinics_km,
#d0 = 50,
power = 0.5,
family = "Hansen"))
colnames(acc_PCN_Clinics_Hansen) <- "accHansen"
acc_PCN_Clinics_Hansen <- tbl_df(acc_PCN_Clinics_Hansen)
hexagon_PCN_Clinics_Hansen <- bind_cols(hexagons_2019, acc_PCN_Clinics_Hansen)
mapex <- st_bbox(hexagons)
mapex_2019 <- st_bbox(hexagons_2019)
tmap_mode("plot")
tm_shape(hexagon_eldercare_Hansen,
bbox = mapex) +
tm_fill(col = "accHansen",
n = 10,
style = "quantile",
border.col = "black",
border.lwd = 1) +
tm_shape(eldercare) +
tm_symbols(size = 0.1) +
tm_layout(main.title = "Accessibility to Eldercare: Hansen method",
main.title.position = "center",
main.title.size = 1.5,
legend.outside = TRUE,
legend.height = 0.45,
legend.format = list(digits = 3),
legend.position = c("right", "top"),
frame = TRUE) +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_grid(lwd = 0.1, alpha = 0.5)
tmap_mode("plot")
tm_shape(hexagon_PCN_Clinics_Hansen,
bbox = mapex_2019) +
tm_fill(col = "accHansen",
n = 10,
style = "quantile",
border.col = "black",
border.lwd = 1) +
tm_shape(eldercare) +
tm_symbols(size = 0.1) +
tm_layout(main.title = "Accessibility to PCN Clinics: Hansen method",
main.title.position = "center",
main.title.size = 1.5,
legend.outside = TRUE,
legend.height = 0.45,
legend.width = 1,
legend.format = list(digits = 3),
frame = TRUE) +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_grid(lwd = 0.1, alpha = 0.5)
hexagon_Hansen <- st_join(hexagon_eldercare_Hansen, mpsz,
join = st_intersects)
ggplot(data=hexagon_Hansen,
aes(y = log(accHansen),
x= REGION_N)) +
geom_boxplot() +
geom_point(stat="summary",
fun.y="mean",
colour ="red",
size=2)
hexagon_Hansen <- st_join(hexagon_PCN_Clinics_Hansen, mpsz,
join = st_intersects)
ggplot(data=hexagon_Hansen,
aes(y = log(accHansen),
x= REGION_N)) +
geom_boxplot() +
geom_point(stat="summary",
fun.y="mean",
colour ="red",
size=2)
tmap_mode('view')
tm_shape(PCN_Clinics)+
tm_dots()
tmap_mode('view')
tm_shape(eldercare)+
tm_dots()
runApp()
runApp()
write_rds(mpsz, "data/models/mpsz_original.rds")
mpsz <- st_read(dsn = "data/geospatial/MPSZ-2019",
layer = "MPSZ-2019") %>%
st_transform(crs = 3414)
write_rds(mpsz, "data/models/mpsz_original.rds")
runApp()
